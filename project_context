ðŸ“‹ Poliestetica - Project Context (v2.0)
ðŸ¥ PANORAMICA PROGETTO
Azienda: Poliestetica Pignatelli Srl
Settore: Poliambulatorio medico specializzato in medicina estetica
Sede: Via Battaglia 71/C, 35020 Albignasego (PD)
Responsabile: Elio Pignatelli, Amministratore Unico
P.IVA: 05096170286
Obiettivo Principale
Sistema di Gestione Compensi Medici automatizzato per eliminare il lavoro manuale di calcolo e gestione compensi, con import automatico fatture e calcolo intelligente basato su regole personalizzabili per medico.
ðŸ—ï¸ ARCHITETTURA TECNICA
Stack Tecnologico

Frontend: Next.js 14 con App Router
Database: Supabase (PostgreSQL + Auth) - Piano Pro per backup
Deployment: Vercel
Styling: Tailwind CSS
Icone: Lucide React
State: Context API (Zustand previsto per produzione)
Testing: Jest + React Testing Library (da implementare)

Struttura Progetto
/workspaces/poliestetica/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/                      # Next.js App Router
â”‚   â”‚   â”œâ”€â”€ layout.tsx           # Layout globale con navigation
â”‚   â”‚   â”œâ”€â”€ page.tsx             # Dashboard homepage
â”‚   â”‚   â”œâ”€â”€ import/page.tsx      # Import Fatture
â”‚   â”‚   â”œâ”€â”€ medici/page.tsx      # Gestione Medici
â”‚   â”‚   â”œâ”€â”€ compensi/page.tsx    # Calcola Compensi
â”‚   â”‚   â””â”€â”€ temp/artifacts/      # Componenti React da integrare
â”‚   â”‚
â”‚   â”œâ”€â”€ components/              # Componenti UI riutilizzabili
â”‚   â”‚   â”œâ”€â”€ ui/                 # Componenti base (Button, Modal, etc)
â”‚   â”‚   â”œâ”€â”€ DevTools.tsx        # Pannello sviluppo (solo dev)
â”‚   â”‚   â””â”€â”€ shared/             # Componenti condivisi
â”‚   â”‚
â”‚   â”œâ”€â”€ data/                   # Dati di configurazione
â”‚   â”‚   â”œâ”€â”€ codici_poliestetica_app.json  # 112 codici validi
â”‚   â”‚   â””â”€â”€ mock/               # Dati mock per sviluppo
â”‚   â”‚       â”œâ”€â”€ index.ts        # Export centralizzato + helpers
â”‚   â”‚       â”œâ”€â”€ medici-regole.json    # 10 medici con regole
â”‚   â”‚       â”œâ”€â”€ pazienti.json        # 50 pazienti demo
â”‚   â”‚       â””â”€â”€ utenti.json          # 3 utenti sistema
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/                  # Utility functions
â”‚   â”‚   â”œâ”€â”€ fattureGenerator.ts # Generatore fatture mock
â”‚   â”‚   â””â”€â”€ fattureHelpers.ts   # Helper functions
â”‚   â”‚
â”‚   â”œâ”€â”€ hooks/                  # React hooks personalizzati
â”‚   â”‚   â””â”€â”€ useFatture.ts       # Hook gestione fatture
â”‚   â”‚
â”‚   â””â”€â”€ types/                  # TypeScript types
â”‚       â””â”€â”€ index.ts            # Type definitions globali
ðŸ“ SISTEMA CODIFICA TRATTAMENTI
Struttura Codici [CRITICO]
[N]PPP[MMM]
 â”‚  â”‚   â””â”€> Codice Prodotto/Macchinario (3 caratteri)
 â”‚  â””â”€â”€â”€â”€â”€> Codice Prestazione (3-4 caratteri) - SEMPRE PRESENTE
 â””â”€â”€â”€â”€â”€â”€â”€â”€> Cifra esenzione IVA (1 numero) - OPZIONALE, DA IGNORARE
Regole di Composizione
1ï¸âƒ£ PRESTAZIONE CON PRODOTTI
Voce 1: [PPP]     "Botox viso"              â‚¬350.00
Voce 2: [PPPMMM]  "BOTOX VISO - ALLERGAN"   â‚¬0.00    2 fiale
âš ï¸ SEMPRE 2+ voci separate, anche con un solo prodotto
2ï¸âƒ£ PRESTAZIONE CON MACCHINARIO
Voce 1: [PPPMMM]  "Laser CO2 frazionato"    â‚¬450.00
âš ï¸ SEMPRE voce unica composta
3ï¸âƒ£ PRESTAZIONE SEMPLICE
Voce 1: [PPP]     "Consulenza estetica"     â‚¬150.00
Vincoli Assoluti

âŒ Prodotto/Macchinario MAI da soli
âœ… 112 combinazioni valide totali
âœ… Prestazioni: 51 (16 con prodotti, 9 con macchinari, 26 semplici)
âœ… Prodotti: 34 | Macchinari: 6

ðŸ—„ï¸ STRUTTURA DATI
Fattura Completa
typescriptinterface Fattura {
  id: number;
  numero: string;              // "FT/2024/1251" o "FT/2024/1251IVA"
  serie: "FT" | "FI" | "M";    // Ignora serie "E"
  data: string;                // "2024-12-20"
  paziente: string;
  medicoId: number | null;     // null = anomalia
  medicoNome: string | null;
  imponibile: number;
  iva: number;                 // 0 o 22%
  totale: number;
  conIva: boolean;
  stato: 'da_importare' | 'verificata' | 'importata' | 'anomalia';
  importata: boolean;
  anomalie: string[];          // Array anomalie fattura
  voci: VoceFattura[];
}
Voce Fattura
typescriptinterface VoceFattura {
  id: number;
  codice: string;              // "3TOX" o "3TOXVEX"
  descrizione: string;
  tipo: 'prestazione' | 'prodotto';
  prestazionePadre?: string;   // Per prodotti: codice prestazione
  importoNetto: number;        // 0 per prodotti
  importoLordo: number;
  quantita: number;
  unita: string;               // "fiala", "ml", "unitÃ ", etc
  anomalie: string[];
}
ðŸ“¦ MODULI IMPLEMENTATI
1. Dashboard âœ…

Menu 6 card con navigazione
Sistema notifiche real-time
Selector ruolo utente
Widget verifica codici sistema

2. Import Fatture âœ… (v3)
Nuova struttura prestazioni/prodotti:

Prestazioni con importo > 0
Prodotti sempre â‚¬0
Associazione automatica per prefisso

Anomalie gestite:

ðŸ‘¤ medico_mancante
ðŸ’° prodotto_con_prezzo
ðŸ”— prodotto_orfano
ðŸ“¦ prestazione_incompleta
ðŸ” prestazione_duplicata
â“ codice_sconosciuto
âš–ï¸ unita_incompatibile
ðŸ”¢ quantita_anomala

3. Gestione Medici âœ… (v4)

CRUD completo medici
Regole compensi configurabili:

Percentuale (su netto/lordo)
Scaglioni (â‚¬X ogni â‚¬Y)
Quota fissa (â‚¬X ogni Y prestazioni)
Importo fisso


Costi prodotti personalizzati per medico
Import/Export Excel funzionante
Tab simulatore compensi

4. Calcola Compensi âœ… (v2)
âš ï¸ DA AGGIORNARE per nuova struttura multi-prodotto

Chiusura gerarchica: medici â†’ mese
Gestione IVA differenziata
Modifica manuale compensi
Export Excel/PDF per tipologia

5. Login âœ…

3 ruoli: Admin, Segretaria, Responsabile
Credenziali demo disponibili
Captcha dopo 2 tentativi

ðŸ”‘ SISTEMA PERMESSI
AzioneAdminAltri RuoliVisualizzare datiâœ…âœ…Modificare compensiâœ…âœ… (se medico+mese aperti)Modificare costi prodottiâœ…âœ…Modificare anagraficaâœ…âŒChiudere medicoâœ…âœ…Riaprire medicoâœ…âœ… (se mese aperto)Chiudere meseâœ…âœ…Riaprire meseâœ…âŒ
ðŸŽ¨ DESIGN SYSTEM
Colori Brand
css--primary: #03A6A6;    /* Turchese */
--secondary: #6192A9;  /* Blu */
--accent-1: #8C786C;
--accent-2: #D9AC9C;
--neutral: #E9EDF2;
UI Guidelines

Modal React custom (no alert/confirm nativi)
Stili inline per colori in artifacts
Feedback visivo immediato
Loading states durante operazioni

ðŸ“Š DATI MOCK E CONFIGURAZIONE
File Dati Disponibili

codici_poliestetica_app.json: 112 combinazioni valide
medici-regole.json: 10 medici con regole e costi
pazienti.json: 50 nomi italiani
utenti.json: 3 utenti sistema

Accesso Centralizzato
typescript// Import da @/data/mock/index
import { 
  medici, 
  getCostoProdotto, 
  isCodiceValido,
  parseCodiceFattura,
  calcolaCompenso 
} from '@/data/mock/index';
Generatore Fatture
typescript// Configurazione
const config = {
  numeroFatture: 200,
  percentualeAnomalie: 15,
  rangeGiorni: 90,
  scenario: 'normale'
};

// Uso
FattureGenerator.generate(config);
FattureGenerator.save(); // localStorage
ðŸ”„ WORKFLOW PRINCIPALI
Import Fatture
1. SYNC da API â†’ 2. IDENTIFICA anomalie â†’ 3. RISOLVI interattivo â†’ 4. IMPORT DB
Chiusura Mensile
1. Verifica fatture API â†’ 2. Chiudi singoli medici â†’ 3. Chiudi mese â†’ 4. Export
Calcolo Compensi
1. Base (netto/lordo) â†’ 2. Detrai costi prodotti â†’ 3. Applica regola â†’ 4. Compenso
ðŸš§ DA IMPLEMENTARE
Alta PrioritÃ 

 Aggiornare Calcola Compensi per multi-prodotto
 Integrazione API Fatture in Cloud reale
 Sistema verifica codici automatico
 Validazione CF/IBAN/P.IVA

Media PrioritÃ 

 Modulo Statistiche (KPI dashboard)
 Modulo Archivio (storico)
 State management con Zustand
 Testing suite completa

Bassa PrioritÃ 

 Audit trail completo
 Bulk operations
 Notifiche email
 Dark mode

ðŸ”Œ INTEGRAZIONI (PRODUZIONE)
Fatture in Cloud API
javascriptGET /c/{company_id}/issued_documents?modified_after={date}
GET /c/{company_id}/products  // Per verifica codici
Supabase Tables
sql-- Da creare
tipo_prestazioni (codice, descrizione, richiede_prodotti, richiede_macchinario)
prestazioni_prodotti_validi (prestazione_codice, prodotto_codice)
fatture (struttura come interfaccia)
compensi_calcolati (medico_id, fattura_id, importo, data_calcolo)
ðŸš€ QUICK START
bash# Clone e setup
git clone [repo]
cd poliestetica
npm install

# Configurazione
cp .env.example .env.local
# Aggiungi keys per Supabase e API

# Development
npm run dev

# Build produzione
npm run build

# Genera fatture mock
# Apri app â†’ DevTools â†’ Genera fatture
ðŸ“ NOTE TECNICHE
Convenzioni Codice

TypeScript strict mode sempre ON
Functional components + hooks
camelCase variabili, PascalCase componenti
Commenti business logic in italiano
Import assoluti con @/

Performance

Lazy loading componenti pesanti
Virtualizzazione liste > 100 items
Debounce su input di ricerca
Memoizzazione calcoli complessi

Sicurezza

Validazione input lato client E server
Sanitizzazione codici fiscali/IBAN
Rate limiting API calls
CORS configurato per domini autorizzati